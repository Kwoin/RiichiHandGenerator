<html>
<head>
    <link type="text/css" href="style.css" rel="stylesheet">
</head>
<body>
  <header>
      <label for="handInput">Main: </label><input type="text" id="handInput" onkeyup="parseHand()"/>
      <label for="tileSize">Taille des tuiles: </label><input type="number" id="tileSize" value="75" onchange="parseHand()"/><br/>
      xxxm = Man, xxxp = Pin, xxxs = Sou, T = Ton, N = Nan, S = Shaa, P = Pei, B = Haku, V = Hatsu, R = Chun<br/>
      Vous pouvez séparer les groupes avec un espace | Vous pouvez inclinez une tuile dans une groupe en ajoutant (x) où x est la position de la tuile inclinée<br/>
      (Exemple: 123m456p789sTNSP P)
  </header>
  <hr/>
  <div id="content">
  </div>
  <footer>
      <hr/>
      <div>
      Auteur: <a href="">Kwoinwoin</a><br/>
      images: <a href="https://github.com/arsdragonfly/riichi-mahjong-tiles">arsdragonfly</a> & <a href="https://github.com/FluffyStuff/riichi-mahjong-tiles">FluffyStuff</a>
      | Licence : <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      </div>
  </footer>

<script type="application/javascript" src="./app/parser/nativeParser.js"></script>
<script type="application/javascript" src="./vendor/html2canvas.min.js"></script>
<script type="application/javascript">
  let hands = [];

  function parseHand() {
    const contentElement = document.getElementById("content");
    contentElement.textContent = "";
    const handValue = document.getElementById("handInput").value.trim();
    const groups = parse(handValue);
    const dlButton = document.createElement("button");
    dlButton.textContent = "(Téléchargement Bientôt Disponible)";
    dlButton.onclick = printToFile;
    const handWrapperElem = document.createElement("div");
    handWrapperElem.setAttribute("id", "handWrapper");
    const handElem = document.createElement("div");
    handElem.setAttribute("id", "hand");
    handWrapperElem.appendChild(handElem);
    groups.forEach(group => {
      groupElem = document.createElement("div");
      groupElem.classList = "group";
      group.forEach(tile => groupElem.appendChild(tile));
      handElem.appendChild(groupElem);
    })
    handWrapperElem.appendChild(dlButton);
    contentElement.appendChild(handWrapperElem);
  }

  function downloadURI(uri, name) {
    const link = document.createElement("a");
    link.download = name;
    link.href = uri;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  function printToFile() {
    const handElem = document.getElementById("hand").firstChild;
    html2canvas(handElem, { allowTaint: true, useCORS: true }).then(canvas => {
        const myImage = canvas.toDataURL("image/png");
        downloadURI("data:" + myImage, "riichiHandGenerator.png");
      }
    );
  }
</script>
<script type="application/javascript" src="./app/hands/yaku.js"></script>
</body>
</html>
